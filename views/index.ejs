<%- include('includes/header')%>
    <section>
        <div class="gap gray-bg">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row" id="page-contents">
                            <div class="col-md-3">
                                <!-- left slidebar -->
                                <%- include('includes/left-slidebar')%>
                            </div>
                            <div class="col-md-6">
                                <div id="add-post-box">
                                    <div class="central-meta">
                                        <div class="new-position">
                                            <figure>
                                                <img style="width:60px;height:60px;"
                                                    src="/image/<%=user.profilePhoto%>">
                                            </figure>
                                            <div class="newpst-input">
                                                <form id="form-add-post" onsubmit="return doPost(this)">
                                                    <input name="type" type="hidden" value="post">
                                                    <textarea rows="2" name="caption"
                                                        placeholder="write something "></textarea>
                                                    <div class="attachments">
                                                        <ul>
                                                            <li>
                                                                <div class="central-meta item" id="sharePostPreview"
                                                                    style="display:none;">
                                                                    
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <img id="post-img-preview" name="postImage"
                                                                    style="display:none;">
                                                            </li>
                                                            <li>
                                                                <video id="post-video-preview" controls
                                                                    style="display:none"></video>
                                                            </li>
                                                            <li>
                                                                <i class="fa fa-image"></i>
                                                                <label class="fileContainer">
                                                                    <input type="file" name="files" accept="image/*"
                                                                        onchange="previewPostImage(this);">
                                                                </label>
                                                            </li>
                                                            <li>
                                                                <i class="fa fa-video-camera"></i>
                                                                <label class="fileContainer">
                                                                    <input type="file" name="files" accept="video/*"
                                                                        onchange="previewPostVideo(this);">
                                                                </label>
                                                            </li>
                                                            <li>
                                                                <button type="submit">Post</button>
                                                            </li>
                                                        </ul>

                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <%  if(posts){ posts.reverse() %>
                                    <% posts.forEach(function(post){ %>
                                        <div class="loadMore" id="newsfeed">
                                            <div class="central-meta item">
                                                <ul id="displayPost">
                                                    <li style="width:100%;">
                                                        <div class="user-post">
                                                            <div class="friend-info">
                                                                <figure>
                                                                    <img src="/image/<%=user.profilePhoto%>"
                                                                        style="width:45px; height:45px; object-fit:cover; border-radius:50%;">
                                                                </figure>
                                                                <div class="friend-name">
                                                                    <ins>
                                                                        <a href=""><%= user.username %>
                                                                        </a>
                                                                    </ins>
                                                                    <% var months = ["Jan", "Feb", "March", "May", "June", "july", "Aug", 'sept', "Oct", "Nov", "Dec"]; 
                                                                    var createdAt = new Date(post.createdAt);
                                                                    var date = createdAt.getDate()+"";
                                                                    date = date.padStart(2,"0")+" "+months[createdAt.getMonth()-1] + ", "+createdAt.getFullYear(); %>

                                                                    <span><%= date %></span>
                                                                </div>
                                                                <div class="post-meta">
                                                                    <div class="description">
                                                                        <p>
                                                                            <%= post.caption %>
                                                                        </p>
                                                                    </div>

                                                                                
                                                        <% if(post.isShared){%>
                                                            <div class="central-meta item">
                                                                <div class="user-post">
                                                                    <div class="friend-info">
                                                                        <figure>
                                                                            <img src="/image/<%= post.sharedPost.owner.profileImage%>" style="width:45px; height:45px; object-fit:cover;">
                                                                        </figure>
                                                                        <div class="friend-name">
                                                                            <ins >
                                                                                <a href="#">
                                                                                    <%= post.sharedPost.owner.name%>
                                                                                </a>
                                                                            </ins>   
                                                                           
                                    
                                                                            <span></span>
                                                                        </div>
                                                                        <div class="post-meta">
                                                                            <div class="description">
                                                                                <p>
                                                                                   beautiful momomm
                                                                                </p>
                                                                            </div>
                                                                                <%if(post.sharedPost.contentType === 'image/jpeg' || post.sharedPost.contentType == 'image/png'){%>
                                                                                    <img src="/image/<%= post.sharedPost.filename%>">
                                                                                <%}%>
                                                                                <%if(post.sharedPost.contentType === 'video/mp4' || post.sharedPost.contentType === 'vid/mp4'){%>
                                                                                    <video style = "height:20%;width:100%;" controls src = "'+mainURL+"/"+data.sharePost.video+'"></video>
                                                                                <%}%>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        <% }%>

                                                            <% if(post.contentType == 'image/png' || post.contentType == 'image/jpeg'){ %>
                                                                <img src="image/<%= post.filename %>" alt="">
                                                            <% } %>
                                                            <% if(post.contentType === 'video/mp4' || post.contentType === 'vid/mp4'){ %>
                                                                <video controls> <source src="video/<%= post.filename %>" type = "video/mp4"></video> 
                                                            <% } %>
                                                            <% var likeColor = false %>
                                                            <% if(post.likers.some(pst=>pst._id.toString() === user._id.toString())){likeColor = true} %>  
                                                                    <div class="we-video-info">
                                                                        <ul>
                                                                            <li>
                                                                                <span onclick="toggleLikePost(this);"
                                                                                    data-id=<%=post._id%>>
                                                                                    <% if(likeColor){%>
                                                                                        <i style="color:blue"
                                                                                            class="fa-solid fa-thumbs-up"></i>
                                                                                        <% }else{%>
                                                                                            <i
                                                                                            class="fa-solid fa-thumbs-up"></i>
                                                                                        <%}%>
                                                                                    <ins><%= post.likers.length%></ins>
                                                                                </span>
                                                                            </li>

                                                                            <li>
                                                                                <span class="comment" title="Comments">
                                                                                    <i class="fa fa-comments-o"></i>
                                                                                    <ins><%= post.comments.length%></ins>
                                                                                </span>
                                                                            </li>

                                                                            <li>
                                                                                <span title="Comments"
                                                                                    onclick="previewSharePost(this);"
                                                                                    data-id=<%= post._id%>>
                                                                                    <i
                                                                                        class="fa-solid fa-share-from-square"></i>
                                                                                    <ins><%= post.shares.length%></ins>
                                                                                </span>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                    <!-- like section ends -->

                                                       
                                                                </div>
                                                            </div>
                                                            <!-- comment section starts -->
                                                            <div class="coment-area">
                                                                <ul class="we-comet" style="max-height:300px ;overflow-y:scroll;">
                                                                    <% post.comments.forEach((comment)=>{ %>
                                                                        <li>
                                                                            <div class="comet-avatar">
                                                                                <img src="image/<%= comment.user.profileImage %>">
                                                                            </div>
                                        
                                                                            <div class="we-comment">
                                                                                <div class="coment-head">
                                                                                    <h5><a href="/"><%= comment.user.name %></a></h5>
                                                                            <span>'+date+'</span>
                                                                            <a class="we-reply" href="javascript:void(0);" data-post-id="'+data._id+'" data-comment-id="'+comment._id+'" onclick="prepareToReply(this);" title="Reply"><i class="fa fa-reply"></i></a>
                                                                            <p>This is a nice comment</p>
                                                                            </div>
                                                                            <ul>
                                                                                <% comment.replies.forEach((reply)=>{ %>
                                                                                    <li>
                                                                                        <div class="comet-avatar">
                                                                                            <img src="">
                                                                                        </div>
                                                                                        <div class="we-comment">
                                                                                            <div class="coment-head">
                                                                                                <h5><a href="/"><%=reply.user.name%></a></h5>
                                        
                                                                                                <span>28th nov</span>
                                                                                            </div>
                                                                                            <p><%=reply.reply%></p>
                                                                                        </div>
                                                                                    </li>
                                                                                    <% }) %>
                                                                            </ul>
                                                                            </li>
                                                                            <%  }) %>
                                                                </ul>
                                                                <ul class="we-comet">
                                                                    <li class="post-comment">
                                                                        <div class="comet-avatar">
                                                                            <img src="/image/<%=user.profilePhoto%>">
                                                                        </div>
                                                                        <div class="post-comt-box">
                                                                            <form method="post" action="/addComment">
                                                                                <input type="hidden" name="_id" value=<%= post._id %>>
                                                                                <textarea name="comment" placeholder="Post your comment"></textarea>
                                                                                <button type="submit">Post</button>
                                                                            </form>
                                                                        </div>
                                                                    </li>
                                                                </ul>
                                                               
                                                                
                                                                </div>
                                                               
                                                        </div>
                                            </div>
                                           
                                        </div>
                                        <% }) %>
                                        <% } %>
                            </div>
                            <div class="col-md-3">
                                <!-- Left slidebar -->
                                <%- include('includes/right-slidebar', {suggestions})%>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

 
    <%- include('includes/footer')%>